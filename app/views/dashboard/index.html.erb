<style type="text/css">
.dataTables_wrapper .row > div {
    display: flex;
    justify-content: space-between;
    width: 100%;
    flex-direction: column;
}

.dataTables_length, #tabla-colaboradores_filter
{
	display: none;
}

.table.dataTable.no-footer {
    display: inline-table;
    border: none;
    overflow: auto;
}

table.dataTable thead .sorting,.table thead tr th[class*='sorting_']:not([class='sorting_disabled']) {
    border-top: 1px solid #eceeef;
}
</style>
<div id="dashboard" class="container-fluid">	
	<div class="pantalla-seccion d-flex justify-content-between mb-2">
		<div class="align-self-end">
			<div class="titulo-pantalla">Dashboard</div>
		</div>  
	</div>
	  <div class="m-t-10">
	    <%= simple_form_for @search, :url => dashboard_index_path, html: { method: :post, id: :dasboard_form } do |f| %>
	    <div class="d-flex flex-wrap justify-content-end bd-highlight" id="sales_search_form">
	      <div class="input-form">
	      <%= f.input :month, collection: (1..7).map {|m| [I18n.l(DateTime.parse(Date::MONTHNAMES[m]), format: "%B").capitalize, m]}, label: 'Mes', wrapper: :select2, selected: @month , label: false %>  
	      </div>
	    </div>
	    <% end %>
	  </div>
	<div class="row text-center">
		<div class="col-md-6">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Cumplimiento de plan</div>
				<canvas id="chart-area1"></canvas>
			</div>
		</div>
		<div class="col-md-6">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Eficiencia</div>
				<canvas id="chart-area2"></canvas>
			</div>
		</div>
	</div>
	<div class="row">
		<div id="productividad-graficos" class="col-md-4 col-xs-12">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Productividad real</div>
				<div id="prod-real"><%= @prod_real %></div>
				<div id="prod-obj">Productividad objetivo <%= number_to_currency @prod_obj.to_i %></div>
			</div>
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Turnos cubiertos</div>
				<div id="turnos-cubiertos">
					<div class="progress">
					  <div class="progress-bar" role="progressbar" style="width: <%= @turnos_cubiertos[:porcentaje] %>%" aria-valuenow="<%= @turnos_cubiertos[:porcentaje] %>" aria-valuemax="100"></div>
					</div>
					<div>
						<div class="color-progress"></div>
						<div class="text-progress">
							<%= @turnos_cubiertos[:texto] %>
						</div> 
					</div>
				</div>
			</div>
			<div class="chart-dashboard">
				<table class="table table-striped">
					<thead>
						<th>Turnos</th>
						<th>Actuales</th>
						<th>Optimizados</th>
					</thead>
					<% @turnosEntrada.count.times do |i| %>
					<tr>
						<td><%= i+1 %></td>
						<td><%= @turnosEntrada[i].to_i %></td>
						<td><%= @turnosOptimizados[i].to_i %></td>
					</tr>
					<% end %>
				</table>
			</div>
		</div>

		<div id="div-tabla" class="col-md-8">
			<div class="chart-dashboard">
				<div>					
					<div class="sub-titulo-pantalla">Cumplimiento de mis colaboradores - <%= I18n.l(Date.parse("#{'%02d' % @month }/01"), format: "%B", locale: :es).capitalize %> <%= @year %></div>
					<br>
					<br>
					<table id="tabla-colaboradores" class="table table-striped table-striped" style="width: 100%">
					<thead>
						<tr>
							<th>Colaboradores</th>
							<th>Ventas</th>
							<th>Meta</th>
							<th>turno asignado</th>
							<th>Cumplimiento</th>
						</tr>
					</thead>
					<tbody>
						<% @setSellers.each do |data| %> 
						<tr>
							<td><%= data[:seller].fullname %></td>
							<td><%= data[:sale] %></td>
							<td><%= data[:plan] %></td>
							<td><%= data[:seller].assigned_shift %></td>
							<td><div class="row"> <div class="col"><%= data[:cumplimiento] %>% </div><%= link_to '<i class="fa fa-caret-right col ml-auto" aria-hidden="true"></i>'.html_safe, data[:seller] %></div></td>
						</tr>
						<% end %>
					</tbody>
					<tfoot></tfoot>
					</table>
				</div>
			</div>
		</div>		
	</div>
	<div class="padding-5em"></div>
</div>




<script type="text/javascript">

	function generateRandomInteger(min, max)
	{
 		return Math.floor(min + Math.random()*(max+1 - min))
	}

	  window.chartColors = {red: "rgb(255, 99, 132)", orange: "rgb(255, 159, 64)", yellow: "rgb(255, 205, 86)", green: "rgb(75, 192, 192)", blue: "rgb(54, 162, 235)", grey: "rgb(201, 203, 207)"}
	
		randomConfig1_1 = <%= @cumplimientoPlan %>;

		if (randomConfig1_1 > 100)
		{
			rConfig1 = 100;
			rConfig2 = 0;
		}
		else
		{
			rConfig1 = randomConfig1_1
			rConfig2 = 100 - randomConfig1_1;
		}

		
		var config1 = {
			type: 'pie',
			data: {
				datasets: [{
					data: [rConfig1, rConfig2],
					backgroundColor: [ window.chartColors.blue, window.chartColors.grey],
					label: 'Dataset 1'
				}],
				labels: [randomConfig1_1 + '% de cumplimiento']
			},
			options: {
				responsive: true,
				tooltips: {
				    enabled: false
				}
			}
		};

		randomConfig2_1 = <%= @margin_adjustment %>;
		if (randomConfig2_1 > 100)
		{
			rConfig1_2 = 100;
			rConfig2_2 = 0;
		}
		else
		{
			rConfig1_2 = randomConfig2_1
			rConfig2_2 = 100 - randomConfig2_1;
		}


		var config2 = {
			type: 'pie',
			data: {
				datasets: [{
					data: [ rConfig1_2, rConfig2_2],
					backgroundColor: [  window.chartColors.red, window.chartColors.grey],
					label: 'Dataset 1'
				}],
				labels: [ randomConfig2_1+'% de Eficiencia (Productividad objetivo <%= number_to_currency @prod_obj.to_i %>)' ]
			},
			options: {
				responsive: true,
				tooltips: {
				    enabled: false
				}
			}
		};

		window.onload = function() {
			var ctx1 = document.getElementById('chart-area1').getContext('2d');
			window.myPie1 = new Chart(ctx1, config1);
			var ctx2 = document.getElementById('chart-area2').getContext('2d');
			window.myPie2 = new Chart(ctx2, config2);
		};

		var colorNames = Object.keys(window.chartColors);
</script>