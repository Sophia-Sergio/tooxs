<script type="text/javascript">
  data = "<%= @brain_json %>";
  var plan_enviado = JSON.parse(data.replace(/&quot;/g,'"'));
</script>

<div class="container-fluid">	
	<div class="pantalla-seccion d-flex justify-content-between mb-2">
		<div class="align-self-end">
			<div class="titulo-pantalla">Dashboard</div>
		</div>  
	</div>
	<div class="sub-titulo-pantalla"><%= I18n.l(Date.parse("#{'%02d' % @month }/01"), format: "%B", locale: :es).capitalize %> <%= @year %></div>
	<div class="row text-center">
		<div class="col-md-6">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Cumplimiento de plan</div>
				<canvas id="chart-area1"></canvas>
			</div>
		</div>
		<div class="col-md-6">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Eficiencia</div>
				<canvas id="chart-area2"></canvas>
			</div>
		</div>
	</div>
	<div class="row">
		<div id="productividad-graficos" class="col-md-3 col-xs-12">
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Productividad Real</div>
				<div id="prod-real"><%= @prod_real %></div>
				<div id="prod-obj">Prod. obj <%= number_to_currency @prod_obj.to_i %></div>
			</div>
			<div class="chart-dashboard">
				<div class="sub-titulo-pantalla">Turnos cubiertos</div>
				<div id="turnos-cubiertos">
					<div class="progress">
					  <div class="progress-bar" role="progressbar" style="width: <%= @turnos_cubiertos[:porcentaje] %>%" aria-valuenow="<%= @turnos_cubiertos[:porcentaje] %>" aria-valuemax="100"></div>
					</div>
					<div>
						<div class="color-progress"></div>
						<div class="text-progress">
							<%= @turnos_cubiertos[:texto] %>
						</div> 
					</div>
				</div>
			</div>
		</div>

		<div id="div-tabla" class="col-md-9">
			<div class="chart-dashboard">
				<div style="overflow-y: auto;">					
					<div class="sub-titulo-pantalla">Cumplimiento de mis colaboradores <%= I18n.l(Date.parse("#{'%02d' % @month }/01"), format: "%B", locale: :es).capitalize %> <%= @year %></div>
					<table class="table table-bordered">
					<thead>
						<tr>
							<th>Colaboradores</th>
							<th>Ventas</th>
							<th>Meta</th>
							<th>Cump.</th>
						</tr>
					</thead>
					<tbody>
						<% @setSellers.each do |data| %> 
						<tr>
							<td><%= data[:seller].fullname %></td>
							<td><%= data[:sale] %></td>
							<td><%= data[:plan] %></td>
							<td><div class="row"> <div class="col"><%= data[:cumplimiento] %>% </div><%= link_to '<i class="fa fa-caret-right col ml-auto" aria-hidden="true"></i>'.html_safe, data[:seller] %></div></td>
						</tr>
						<% end %>
					</tbody>
					<tfoot></tfoot>
					</table>
				</div>
			</div>
		</div>		
	</div>
	<div class="padding-5em"></div>
</div>




<script type="text/javascript">

	function generateRandomInteger(min, max)
	{
 		return Math.floor(min + Math.random()*(max+1 - min))
	}

	  window.chartColors = {red: "rgb(255, 99, 132)", orange: "rgb(255, 159, 64)", yellow: "rgb(255, 205, 86)", green: "rgb(75, 192, 192)", blue: "rgb(54, 162, 235)", grey: "rgb(201, 203, 207)"}
	
		randomConfig1_1 = <%= @cumplimientoPlan %>;
		randomConfig1_2 = 100 - randomConfig1_1;
		
		var config1 = {
			type: 'pie',
			data: {
				datasets: [{
					data: [randomConfig1_1, randomConfig1_2],
					backgroundColor: [ window.chartColors.blue, window.chartColors.grey],
					label: 'Dataset 1'
				}],
				labels: [randomConfig1_1 + '% de cumplimiento']
			},
			options: {
				responsive: true
			}
		};

		randomConfig2_1 = <%= @margin_adjustment %>;
		randomConfig2_2 = 100 - randomConfig2_1;

		var config2 = {
			type: 'pie',
			data: {
				datasets: [{
					data: [ randomConfig2_1, randomConfig2_2],
					backgroundColor: [  window.chartColors.red, window.chartColors.grey],
					label: 'Dataset 1'
				}],
				labels: [ randomConfig2_1+'% de Eficiencia (Prod. obj. <%= number_to_currency @prod_obj.to_i %>)' ]
			},
			options: {
				responsive: true
			}
		};

		window.onload = function() {
			var ctx1 = document.getElementById('chart-area1').getContext('2d');
			window.myPie1 = new Chart(ctx1, config1);
			var ctx2 = document.getElementById('chart-area2').getContext('2d');
			window.myPie2 = new Chart(ctx2, config2);
		};

		var colorNames = Object.keys(window.chartColors);
</script>