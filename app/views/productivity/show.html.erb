<script type="text/javascript">
  data = "<%= @brain_json %>";
  var plan_enviado = JSON.parse(data.replace(/&quot;/g,'"'));
</script>

<div class="container-fluid" id="productivity_demo">
  <div class="pantalla-seccion d-flex justify-content-between mb-2">
    <div class="align-self-end">
      <div class="titulo-pantalla">Optimizador de turnos</div>
    </div>    
  </div>

  <div class="sub-titulo-pantalla">Parámetros</div>
  <div>
    <%= simple_form_for @search, :url => productivity_show_path, :class => 'row', :method => :get do |f| %>
    <div class="d-flex justify-content-end bd-highlight" id="sales_search_form">

      <div class="input-form">
        <%= f.input :store, collection: @stores, label: 'Tienda', wrapper: :select2, selected: params[:store]  %>  
      </div>

      <div class="input-form">
        <%= f.input :department, collection: @departments, label: 'Departamento', wrapper: :select2,selected: params[:department] %>  
      </div>

      <div class="input-form">
        <%= f.input :year, collection: (2018..2018), label: 'Año', wrapper: :select2, selected: params[:year] %>  
      </div>

      <div class="input-form">
        <%= f.input :month, collection: (1..8).map {|m| [I18n.l(DateTime.parse(Date::MONTHNAMES[m]), format: "%B").capitalize, m]}, label: 'Mes', wrapper: :select2, selected: params[:month]  %>  
      </div>

      <div>
        <%= button_tag type: 'submit', class: "btn btn-success btn-lg btn-larger" do %>
        <i class="fa fa-search" aria-hidden="true"></i> Buscar
        <% end %>
      </div>  
    </div>
    <% end %>
  </div>

  <div class="formulario-comparacion">
    <div class="sub-titulo-pantalla">Resultado de búsqueda</div>
    <div class="row ">  
      <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
        <h5 class="text-uppercase m-t-30 fs-13 bold">Alto Las Condes - Rincon Juvenil Mujer - <%= I18n.l(Date.parse("#{'%02d' % params[:month] }/01"), format: "%B", locale: :es).capitalize %> <%= params[:year] %></h5>
        <div class="row ">
          <div class="col-sm-12 col-xl-10 offset-xl-1">
            <div id="chartContainer" style="width:100%;">
              <canvas id="canvas"> </canvas>
            </div>
          </div>             
          <div id="productividades" class="col-md-6 offset-md-3"></div>
        </div>
        <div id="botones-optimizar" class="row m-t-30" style="display: none">
          <div class="col-xl-1">
            <input type="number" class="form-control" id="minutos_optimizando" name="minutos_optimizando" placeholder="minutos" min="0" max="10">
          </div>
          <div class="col-xl-11" >
            <button type="button" class="btn btn-info btn-optimize"> <i class="fa fa-cogs"></i> Optimizar </button>
            <button type="button" class="btn btn-success btn-detalle"> <i class="fa fa-cogs"></i> Detalle </button>
          </div>
        </div>            
      </div>
    </div>
  </div>

  <div class="formulario-comparacion">
    <div class="col-md-6 offset-md-3">
      <div >
        <h3>Planificación de dotación</h3>      
      </div>
      <table  id="tabla-resumen" class="table table-bordered">
        <thead>
          <th>Turnos</th>
          <th>Dotación actual</th>
          <th>Dotación optimizada</th>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
          <tr>
            <td>Eficiencia dotación</td>
            <td id="margen-actual">%</td>
            <td id="margen-optimizado">%</td>
          </tr>
          <tr>
            <td>HH Totales</td>
            <td id="hh-actual">0</td>
            <td id="hh-optimizado">0</td>
          </tr>
        </tfoot>
      </table>
    </div>
  </div>
  
  <div id="detalle-dotacion" class="formulario-comparacion">  
    <div class="sub-titulo-pantalla">Resultado de búsqueda</div>
    <div>
      <span class="dotacion label label-success tip" data-toggle="tooltip">Actual</span>
      <span class="dotacion label label-primary tip" data-toggle="tooltip">Optimizado</span>
    </div>
    <div class="row">  
      <div class="col-lg-6 col-xl-6 col-sm-12">
        <table class="table-shift table table-bordered">
          <thead>
            <tr>
              <th colspan="8">Semana 1</th>
            </tr>
            <tr>
                <th class="text-center"> Hora</th>
              <% @staffing_w1[:dates].each do |d| %>
                <th class="text-center"> <%= d.to_date.strftime("%d") %></th>
              <% end -%>
            </tr>
          </thead>
          <tbody class="t-p-3">
            <% hora = -1 
               dia = 0
               countTurnos = 0 %>                         
            <% @staffing_w1[:draw].each do |k,v|%>
            <tr>
              <td class="text-center" align="center"><%= k %>:00</td>
              <% dia = 0 %>
              <% v.first.each do |n| %>
                <% if n != 0 %>
                <td class="hora text-center">
                  <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                  <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                </td>  
              <% dia += 10 %>
                <% else %>
                <td>  </td>
                <% end -%>
              <% end -%>
            </tr>
            <% hora += 1 %>
            <% end -%>
          </tbody>
        </table>
      </div>
      <div class="col-lg-6 col-xl-6 col-sm-12">
        <table class="table-shift table table-bordered">
          <thead>
            <tr>
              <th colspan="8">Semana 1</th>
            </tr>
            <tr>
                <th class="text-center"> Hora </th>
              <% @staffing_w2[:dates].each do |d| %>
                <th class="text-center"> <%= d.to_date.strftime("%d") %></th>
              <% end -%>
            </tr>
          </thead>
          <tbody class="t-p-3">
            <% hora = 69 
               dia = 0
               countTurnos = 0 %>   
            <% @staffing_w2[:draw].each do |k,v|%>
            <tr>
              <td class="text-center" align="center"><%= k %>:00</td>
              <% dia = 0 %>
              <% v.first.each do |n| %>
                <% if n != 0 %>
                <td class="text-center">
                  <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                  <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                </td>  
                <% dia += 10 %>
                <% else %>
                <td>  </td>
                <% end -%>
              <% end -%>
            </tr>
            <% hora += 1 %>
            <% end -%>
          </tbody>
        </table>
      </div>              
      <div class="col-lg-6 col-xl-6 col-sm-12">
        <table class="table-shift table table-bordered">
          <thead>
            <tr>
              <th colspan="8">Semana 1</th>
            </tr>
            <tr>
                <th class="text-center"> Hora </th>
              <% @staffing_w3[:dates].each do |d| %>
                <th class="text-center"> <%= d.to_date.strftime("%d") %></th>
              <% end -%>
            </tr>
          </thead>
          <tbody class="t-p-3">
            <% hora = 139 
               dia = 0
               countTurnos = 0 %>   
            <% @staffing_w3[:draw].each do |k,v|%>
            <tr>
              <td class="text-center" align="center"><%= k %>:00</td>
              <% dia = 0 %>
              <% v.first.each do |n| %>
                <% if n != 0 %>
                <td class="text-center">
                  <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"></span>
                  <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                </td>  
                <% dia += 10 %>
                <% else %>
                <td>  </td>
                <% end -%>
              <% end -%>
            </tr>
            <% hora += 1 %>
            <% end -%>
          </tbody>             
        </table>
      </div>              
      <div class="col-lg-6 col-xl-6 col-sm-12">
        <table class="table-shift table table-bordered">
          <thead>
            <tr>
              <th colspan="8">Semana 1</th>
            </tr>
            <tr>
                <th class="text-center"> Hora </th>
              <% @staffing_w4[:dates].each do |d| %>
                <th class="text-center"> <%= d.to_date.strftime("%d") %></th>
              <% end -%>
            </tr>
          </thead>
          <tbody class="t-p-3">
            <% hora = 209 
               dia = 0
               countTurnos = 0 %>   
            <% @staffing_w4[:draw].each do |k,v|%>
            <tr>
              <td class="text-center" align="center"><%= k %>:00</td>
              <% dia = 0 %>
              <% v.first.each do |n| %>
                <% if n != 0 %>
                <td class="text-center">
                  <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                  <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                </td>  
                <% dia += 10 %>
                <% else %>
                <td>  </td>
                <% end -%>
              <% end -%>
            </tr>
            <% hora += 1 %>
            <% end -%>
          </tbody>
        </table>
      </div>  
    </div>              
  </div>
</div>
