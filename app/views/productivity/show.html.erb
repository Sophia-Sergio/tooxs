<div class="card card-transparent" id="productivity_demo">
  <div class="card-header ">
    <div class="card-title ">
      Parámetros de Búsqueda - Productividad Tiendas
    </div>
  </div>

  <div class="card-block">
    <%= simple_form_for @search, :url => staffing_show_path, :method => :get do |f| %>
    <div class="row" id="sales_search_form">

      <div class="col-12 col-sm-6 col-md-6 col-lg-3">
        <%= f.input :store, collection: @stores, label: 'Tienda', wrapper: :select2, selected: 1, :disabled => true %>  
      </div>

      <div class="col-12 col-sm-6 col-md-6 col-lg-3">
        <%= f.input :department, collection: @departments, label: 'Departamento', wrapper: :select2,selected: 1, :disabled => true %>  
      </div>

      <div class="col-12 col-sm-3 col-md-3 col-lg-2">
        <%= f.input :year, collection: (2016..2018), label: 'Año', wrapper: :select2, selected: 2018, :disabled => true %>  
      </div>

      <div class="col-12 col-sm-3 col-md-3 col-lg-2">
        <%= f.input :month, collection: (1..12).map {|m| [I18n.l(DateTime.parse(Date::MONTHNAMES[m]), format: "%B").capitalize, m]}, label: 'Mes', wrapper: :select2, selected: 3, :disabled => true  %>  
      </div>

      <div class="col-12 col-sm-3 col-md-3 col-lg-1">
        <%= button_tag type: 'submit', :disabled => true,class: "btn btn-success btn-lg btn-larger" do %>
        <i class="fa fa-search" aria-hidden="true"></i> Buscar
        <% end %>

      </div>  
    </div>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-block">
      <div class="row">
          <div class="col-lg-12">
            <h4 class="bold">Productividad</h4>  
          </div>
      </div>

      <div class="row ">  
          <div class="col-12 col-sm-12 col-md-12 col-lg-12 col-xl-12">
            <h5 class="text-uppercase m-t-30 fs-13 bold">Productividad por Hora // Alto Las Condes - Rincon Juvenil Mujer - Marzo 2018 </h5>
            <div class="row ">
              <div class="col-sm-12 col-xl-10 offset-xl-1">
                <div id="chartContainer" style="width:100%;">
                  <canvas id="canvas"> </canvas>
                </div>
              </div>             
              <div class="col-md-6 offset-md-3">
                <h3>Productividad Actual por semanas</h3>                    
                    <table class="dn table-shift table table-bordered bg-master-lightest table-smallFont">
                      <thead>
                        <tr class="bg-success">
                          <td colspan="8" class="text-center no-padding">
                            <h3 class="no-margin text-uppercase text-white fs-15">Febrero 2018 - Semana 1 </h3>
                          </td>
                        </tr>

                        <tr>
                          <td> - </td>
                          <% @w1_days.each do |d| %>
                          <td><%= d.to_s.to_date.strftime('%d-%m-%Y') %></td>
                          <% end -%>
                        </tr>
                      </thead>
                        <tr>
                          <td>Plan de Venta </td>
                          <% @sp_w1_daily.each do |d| %>
                          <td><%= number_to_currency d %></td>
                          <% end -%>
                        </tr>

                        <tr>
                          <td>Dotación(HH) </td>
                          <% @sd_w1_daily.each do |u| %>
                          <td><%= u %></td>
                          <% end -%>
                        </tr>

                        <tr>
                          <td>Optima </td>
                          <% @prd_w1_day.each do |p| %>
                          <td><%= number_to_currency p %></td>
                          <% end -%>
                        </tr>
                        <tr>
                          <td>Real</td>
                          <% @prd_w2_day.each do |p| %>
                          <td><%= number_to_currency p %></td>
                          <% end -%>
                        </tr>
                        <tr>
                          <td>Optimizada</td>
                          <% @prd_w3_day.each do |p| %>
                          <td><%= number_to_currency p %></td>
                          <% end -%>
                        </tr>

                    </table>
                    <table id="table_shift_w1" class="table-shift table table-bordered bg-master-lightest table-smallFont>
                      <thead>
                        <tr class="bg-success">
                          <td colspan="8" class="text-center no-padding">
                            <h3 class="no-margin text-uppercase text-white fs-15">Marzo 2018</h3>
                          </td>
                        </tr>
                        <tr>
                          <th class="text-center"></th>
                          <th class="text-center">Semana 1</th>
                          <th class="text-center">Semana 2</th>
                          <th class="text-center">Semana 3</th>
                          <th class="text-center">Semana 4</th>
                        </tr>
                      </thead>
                      <tbody class="t-p-3">
                      	<tr>
                      		<td>Plan de Venta</td>
                          <td id="plan-w1"></td>
                          <td id="plan-w2"></td>
                          <td id="plan-w3"></td>
                          <td id="plan-w4"></td>
                        </tr>

                        <tr>
                          <td>Dotación Semanal (HH)</td>
                          <td id="dotacion-w1"></td>
                          <td id="dotacion-w2"></td>
                          <td id="dotacion-w3"></td>
                          <td id="dotacion-w4"></td>
                        </tr>

                        <tr>
                          <td>Productividad Esperada por HH</td>
                          <td id="productividad-w1"></td>
                          <td id="productividad-w2"></td>
                          <td id="productividad-w3"></td>
                          <td id="productividad-w4"></td>
                        </tr>                        
                      </tbody>
                    </table>
              </div>
            </div>
            <div class="row m-t-30">
              <div class="col-xl-1">
                <input type="number" class="form-control" id="minutos_optimizando" name="minutos_optimizando" placeholder="minutos" min="0" max="10">
              </div>
              <div class="col-xl-11">
                <button type="button" class="btn btn-info btn-optimize"> <i class="fa fa-cogs"></i> Optimizar </button>
                <button type="button" class="btn btn-success btn-detalle"> <i class="fa fa-cogs"></i> Detalle </button>
              </div>
            </div>            
          
          </div>
        </div>
      </div>
    </div>
    <div id="detalle-dotacion" class="row" style="display: none">  
            <div class="col-md-6 offset-md-3">
              <div >
                <h3>Resumen turnos</h3>      
              </div>
              <table  id="tabla-resumen" class="table table-bordered">
                <thead>
                  <th>Turnos</th>
                  <th>Dotación actual</th>
                  <th>Dotación optimizada</th>
                </thead>
                <tbody>
                </tbody>
                <tfoot>
                  <tr>
                    <td>Eficiencia dotación</td>
                    <td id="margen-actual">%</td>
                    <td id="margen-optimizado">%</td>
                  </tr>
                  <tr>
                    <td>HH Totales</td>
                    <td id="hh-actual">0</td>
                    <td id="hh-optimizado">0</td>
                  </tr>
                </tfoot>
              </table>
            </div>
          <div class="col-md-12">
                <h3>Detalle por semanas</h3>      
              </div>
          <div class="col-md-12">
            <span class="dotacion label label-success tip" data-toggle="tooltip">Actual</span>
            <span class="dotacion label label-primary tip" data-toggle="tooltip">Optimizado</span>
          </div>
      <div class="col-xl-6 col-lg-12">
           
            <table id="table_shift_w1" class="table-shift table table-bordered bg-master-lightest">
              <thead>
                <tr class="bg-success">
                  <td colspan="8" class="text-center no-padding">
                    <h3 class="no-margin text-uppercase text-white fs-15">Semana 1</h3>
                  </td>
                </tr>
                <tr>
                    <th class="text-center"> Fecha </th>
                  <% @staffing_w1[:dates].each do |d| %>
                    <th class="text-center"> <%= d.to_date.strftime("%d-%m-%Y") %></th>
                  <% end -%>
                </tr>
              </thead>
              <tbody class="t-p-3">
                <% hora = -1 
                   dia = 0
                   countTurnos = 0 %>                         
                <% @staffing_w1[:draw].each do |k,v|%>
                <tr>
                  <td class="text-center" align="center"><%= k %>:00</td>
                  <% dia = 0 %>
                  <% v.first.each do |n| %>
                    <% if n != 0 %>
                    <td class="hora text-center">
                      <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                      <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                    </td>  
                  <% dia += 10 %>
                    <% else %>
                    <td>  </td>
                    <% end -%>
                  <% end -%>
                </tr>
                <% hora += 1 %>
                <% end -%>
              </tbody>
            </table>
      </div>
      <div class="col-xl-6 col-lg-12">
            <table id="table_shift_w1" class="table-shift table table-bordered bg-master-lightest">
              <thead>
                <tr class="bg-success">
                  <td colspan="8" class="text-center no-padding">
                    <h3 class="no-margin text-uppercase text-white fs-15">Semana 2</h3>
                  </td>
                </tr>
                <tr>
                    <th class="text-center"> Fecha </th>
                  <% @staffing_w2[:dates].each do |d| %>
                    <th class="text-center"> <%= d.to_date.strftime("%d-%m-%Y") %></th>
                  <% end -%>
                </tr>
              </thead>
              <tbody class="t-p-3">
                <% hora = 69 
                   dia = 0
                   countTurnos = 0 %>   
                <% @staffing_w2[:draw].each do |k,v|%>
                <tr>
                  <td class="text-center" align="center"><%= k %>:00</td>
                  <% dia = 0 %>
                  <% v.first.each do |n| %>
                    <% if n != 0 %>
                    <td class="text-center">
                      <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                      <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                    </td>  
                    <% dia += 10 %>
                    <% else %>
                    <td>  </td>
                    <% end -%>
                  <% end -%>
                </tr>
                <% hora += 1 %>
                <% end -%>
              </tbody>
            </table>
      </div>              
      <div class="col-xl-6 col-lg-12">
            <table id="table_shift_w1" class="table-shift table table-bordered bg-master-lightest">
              <thead>
                <tr class="bg-success">
                  <td colspan="8" class="text-center no-padding">
                    <h3 class="no-margin text-uppercase text-white fs-15">Semana 3</h3>
                  </td>
                </tr>
                <tr>
                    <th class="text-center"> Fecha </th>
                  <% @staffing_w3[:dates].each do |d| %>
                    <th class="text-center"> <%= d.to_date.strftime("%d-%m-%Y") %></th>
                  <% end -%>
                </tr>
              </thead>
              <tbody class="t-p-3">
                <% hora = 139 
                   dia = 0
                   countTurnos = 0 %>   
                <% @staffing_w3[:draw].each do |k,v|%>
                <tr>
                  <td class="text-center" align="center"><%= k %>:00</td>
                  <% dia = 0 %>
                  <% v.first.each do |n| %>
                    <% if n != 0 %>
                    <td class="text-center">
                      <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"></span>
                      <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                    </td>  
                    <% dia += 10 %>
                    <% else %>
                    <td>  </td>
                    <% end -%>
                  <% end -%>
                </tr>
                <% hora += 1 %>
                <% end -%>
              </tbody>             
            </table>
      </div>              
      <div class="col-xl-6 col-lg-12">
            <table id="table_shift_w1" class="table-shift table table-bordered bg-master-lightest">
              <thead>
                <tr class="bg-success">
                  <td colspan="8" class="text-center no-padding">
                    <h3 class="no-margin text-uppercase text-white fs-15">Semana 4</h3>
                  </td>
                </tr>
                <tr>
                    <th class="text-center"> Fecha </th>
                  <% @staffing_w4[:dates].each do |d| %>
                    <th class="text-center"> <%= d.to_date.strftime("%d-%m-%Y") %></th>
                  <% end -%>
                </tr>
              </thead>
              <tbody class="t-p-3">
                <% hora = 209 
                   dia = 0
                   countTurnos = 0 %>   
                <% @staffing_w4[:draw].each do |k,v|%>
                <tr>
                  <td class="text-center" align="center"><%= k %>:00</td>
                  <% dia = 0 %>
                  <% v.first.each do |n| %>
                    <% if n != 0 %>
                    <td class="text-center">
                      <span id="optimo-<%= hora+dia %>" class="dotacion label label-success tip" data-toggle="tooltip"> </span>
                      <span id="optimizado-<%= hora+dia %>" class="dotacion label label-primary tip" data-toggle="tooltip"></span>
                    </td>  
                    <% dia += 10 %>
                    <% else %>
                    <td>  </td>
                    <% end -%>
                  <% end -%>
                </tr>
                <% hora += 1 %>
                <% end -%>
              </tbody>
            </table>
      </div>                
    </div>
</div>
